<!--base.htmlã‚’ç¶™æ‰¿-->
{% extends "base.html" %}

{% block body_class %}home-page{% endblock %}

{% block content %}
    <div class="home-container">
        
        <p class="welcome-text">
            {% if user.is_authenticated %}
                ã‚ˆã†ã“ãã€{{ user.username }}ã•ã‚“
            {% else %}
                ã‚ˆã†ã“ãã€ã‚²ã‚¹ãƒˆã•ã‚“
            {% endif %}
        </p>

<!--start æ¤œç´¢çª“ã¨ã‹è«¸ã€…è¿½è¨˜-->
        <h1 class="section-title">ã‚³ã‚¹ãƒ¡æ¤œç´¢</h1>

        <form action="{% url 'form_app:product_search' %}" method="GET" class="search-area">
            <input type="text" name="q" class="form-input search-input" placeholder="ã‚³ã‚¹ãƒ¡ã®åç§°ã‚’å…¥åŠ›">
            <button type="submit" class="search-button">ğŸ”</button>
        </form>

        <div class="category-container">
            <ul class="category-list">
                <li><a href="{% url 'form_app:category_product_list' 'skincare' %}">ã‚¹ã‚­ãƒ³ã‚±ã‚¢</a></li>
                <li><a href="{% url 'form_app:category_product_list' 'uvcare' %}">UVã‚±ã‚¢</a></li>
                <li><a href="{% url 'form_app:category_product_list' 'basemake' %}">ãƒ™ãƒ¼ã‚¹ãƒ¡ã‚¤ã‚¯</a></li>
                <li><a href="{% url 'form_app:category_product_list' 'pointmake' %}">ãƒã‚¤ãƒ³ãƒˆãƒ¡ã‚¤ã‚¯</a></li>
                <li><a href="{% url 'form_app:category_product_list' 'bodycare' %}">ãƒœãƒ‡ã‚£ã‚±ã‚¢</a></li>
                <li><a href="{% url 'form_app:category_product_list' 'haircare' %}">ãƒ˜ã‚¢ã‚±ã‚¢</a></li>
                <li><a href="{% url 'form_app:category_product_list' 'other' %}">ãã®ä»–</a></li>
            </ul>
        </div>

        <div class="review-header">
            {% if user.is_authenticated %}
                <a href ="{% url 'form_app:review_entry' %}" class="btn btn-secondary">
                    âœãƒ¬ãƒ“ãƒ¥ãƒ¼æŠ•ç¨¿
                </a>
            {% endif %}
        </div>

        <h2 class="section-title">äººæ°—ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã€€ï¼´ï¼¯ï¼°ï¼•</h2>
        <p class="ranking-note">
            â€»ãƒ¬ãƒ“ãƒ¥ãƒ¼ä»¶æ•°ãŒå¤šã„å•†å“ã‚’å„ªå…ˆã—ã¦è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚
        </p>

        <div id="home-ranking">
            {% include "form_app/_product_list.html" with products=ranking_products show_rank=True empty_message="ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚" %}
        </div>

        <div id="productModal" class="modal hidden">
            <div class="modal-content">
                <span class="modal-close">âœ–</span>

                <img id="modalImage">
                <h2 id="modalName"></h2>
                <p id="modalPrice"></p>

                <div id="modalStars" class="stars"></div>
                <a id="modalDetailLink" class="stars_link">è©³ç´°ã‚’è¦‹ã‚‹</a>

            </div>
        </div>
        
        <a href="{% url 'form_app:ranking_all' %}" class="more-link">ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’ã‚‚ã£ã¨è¦‹ã‚‹â¡</a>

    </div>
{% endblock content %}


{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", () => {

    const rankingArea = document.getElementById("home-ranking");
    if (!rankingArea) return;

    rankingArea.addEventListener("click", e => {
        const link = e.target.closest(".product-card a");
        if (!link) return;

        e.preventDefault(); // å•†å“è©³ç´°ã¸ã®é·ç§»ã‚’æ­¢ã‚ã‚‹
        
        const card = link.closest(".product-card");
        if (!card) return;

        const image = card.querySelector("img")?.src || "";
        const name = card.querySelector("h3")?.innerText || "";
        const stars = card.querySelector(".stars")?.innerHTML || "";
        const price = card.dataset.price || "ä¾¡æ ¼æœªè¨­å®š";
        const detailUrl = link.href;

        document.getElementById("modalImage").src = image;
        document.getElementById("modalName").textContent = name;
        document.getElementById("modalStars").innerHTML = stars;
        document.getElementById("modalPrice").textContent = `ï¿¥${price}`;
        document.getElementById("modalDetailLink").href = detailUrl;

        document.getElementById("productModal").classList.remove("hidden");
    });

    document.querySelector(".modal-close")?.addEventListener("click", () => {
        document.getElementById("productModal").classList.add("hidden");
        });
});
</script>
{% endblock %}

