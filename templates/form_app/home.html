<!--base.html„ÇíÁ∂ôÊâø-->
{% extends "base.html" %}

{% block body_class %}home-page{% endblock %}

{% block content %}
    <div class="home-container">

        {% if user.is_authenticated %}
            „Çà„ÅÜ„Åì„Åù„ÄÅ{{ user.username }}„Åï„Çì
        {% else %}
            „Çà„ÅÜ„Åì„Åù„ÄÅ„Ç≤„Çπ„Éà„Åï„Çì
        {% endif %}

<!--start Ê§úÁ¥¢Á™ì„Å®„ÅãË´∏„ÄÖËøΩË®ò-->
        <h1 class="section-title">„Ç≥„Çπ„É°Ê§úÁ¥¢</h1>

        <form action="{% url 'form_app:product_search' %}" method="GET" class="search-area">
            <input type="text" name="q" class="search-input" placeholder="„Ç≥„Çπ„É°„ÅÆÂêçÁß∞„ÇíÂÖ•Âäõ">
            <button type="submit" class="search-button">üîç</button>
        </form>


        <div class="category-container">
            <ul class="category-list">
                <li><a href="{% url 'form_app:category_product_list' 'skincare' %}">„Çπ„Ç≠„É≥„Ç±„Ç¢</a></li>
                <li><a href="{% url 'form_app:category_product_list' 'uvcare' %}">UV„Ç±„Ç¢</a></li>
                <li><a href="{% url 'form_app:category_product_list' 'basemake' %}">„Éô„Éº„Çπ„É°„Ç§„ÇØ</a></li>
                <li><a href="{% url 'form_app:category_product_list' 'pointmake' %}">„Éù„Ç§„É≥„Éà„É°„Ç§„ÇØ</a></li>
                <li><a href="{% url 'form_app:category_product_list' 'bodycare' %}">„Éú„Éá„Ç£„Ç±„Ç¢</a></li>
                <li><a href="{% url 'form_app:category_product_list' 'haircare' %}">„Éò„Ç¢„Ç±„Ç¢</a></li>
                <li><a href="{% url 'form_app:category_product_list' 'other' %}">„Åù„ÅÆ‰ªñ</a></li>
            </ul>
        </div>


        <h2 class="section-title">Á∑èÂêà„É©„É≥„Ç≠„É≥„Ç∞</h2>

        <div id="home-ranking">
            {% include "form_app/_product_list.html" with products=ranking_products show_rank=True empty_message="„É©„É≥„Ç≠„É≥„Ç∞„ÅØ„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ" %}
        </div>

        <div id="productModal" class="modal hidden">
            <div class="modal-content">
                <span class="modal-close">‚úñ</span>

                <img id="modalImage">
                <h2 id="modalName"></h2>
                <p id="modalPrice"></p>

                <div id="modalStars" class="stars"></div>
                <a id="modalDetailLink" class="stars_link">„É¨„Éì„É•„Éº„ÇíË¶ã„Çã</a>

            </div>
        </div>

        <!--end Ê§úÁ¥¢Á™ì„Å®„ÅãË´∏„ÄÖËøΩË®ò-->
        <div class="welcome-text"></div>   

        <div class="review-header">
            {% if user.is_authenticated %}
                <a href ="{% url 'form_app:review_entry' %}" class="review-button">
                    ‚úç„É¨„Éì„É•„ÉºÊäïÁ®ø
                </a>
            {% endif %}
        </div>
    </div>
{% endblock content %}


{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", () => {

    const rankingArea = document.getElementById("home-ranking");
    if (!rankingArea) return;

    rankingArea.addEventListener("click", e => {
        const link = e.target.closest(".product-card a");
        if (!link) return;

        e.preventDefault(); // ÂïÜÂìÅË©≥Á¥∞„Å∏„ÅÆÈÅ∑Áßª„ÇíÊ≠¢„ÇÅ„Çã
        
        const card = link.closest(".product-card");
        if (!card) return;

        const image = card.querySelector("img")?.src || "";
        const name = card.querySelector("h3")?.innerText || "";
        const stars = card.querySelector(".stars")?.innerHTML || "";
        const price = card.dataset.price || "‰æ°Ê†ºÊú™Ë®≠ÂÆö";
        const detailUrl = link.href;

        document.getElementById("modalImage").src = image;
        document.getElementById("modalName").textContent = name;
        document.getElementById("modalStars").innerHTML = stars;
        document.getElementById("modalPrice").textContent = `Ôø•${price}`;
        document.getElementById("modalDetailLink").href = detailUrl;

        document.getElementById("productModal").classList.remove("hidden");
    });

    document.querySelector(".modal-close")?.addEventListener("click", () => {
        document.getElementById("productModal").classList.add("hidden");
        });
});
</script>
{% endblock %}

